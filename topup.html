// ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                    try {
                        if (typeof liff !== 'undefined' && liff.isApiAvailable && liff.isApiAvailable('shareTargetPicker')) {
                            const message = {
                                type: 'text',
                                text: `‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\nüí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ‡∏ø${formatCurrency(amount)}\nüè¶ ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ${bank}\nüìÑ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${finalTransactionId}\nüìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${finalStatus}\n‚è∞ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô - ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡∏ó‡∏≠‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Prompt', sans-serif;
        }
        .mobile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 40;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .back-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        .page-title {
            font-size: 1.25rem;
            font-weight: 600;
            flex: 1;
            text-align: center;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .process-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
        }
        .process-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e5e7eb;
            z-index: 1;
        }
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e7eb;
            color: #9ca3af;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .step.active .step-number {
            background: #3b82f6;
            color: white;
            animation: pulse 2s infinite;
        }
        .step.completed .step-number {
            background: #10b981;
            color: white;
        }
        .step-text {
            font-size: 0.75rem;
            color: #6b7280;
            text-align: center;
        }
        .step.active .step-text {
            color: #3b82f6;
            font-weight: 500;
        }
        .step.completed .step-text {
            color: #10b981;
            font-weight: 500;
        }
        .btn-animate {
            transition: all 0.3s ease;
        }
        .btn-animate:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .file-preview {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }
        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Mobile Header -->
    <div class="mobile-header p-4 flex items-center space-x-4">
        <button onclick="goBack()" class="back-btn">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h1 class="page-title">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</h1>
        <div class="w-10"></div> <!-- Spacer for center alignment -->
    </div>

    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <i class="fas fa-wallet text-6xl text-blue-500 animate-pulse mb-4"></i>
            <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        </div>
    </div>

    <!-- Main Content -->
    <div id="app" class="hidden page-container p-4">
        <div class="max-w-md mx-auto">
            <!-- Process Steps -->
            <div class="bg-white rounded-lg shadow p-4 mb-6 card-hover">
                <div class="process-steps mb-6">
                    <div id="step1" class="step active">
                        <div class="step-number">1</div>
                        <div class="step-text">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                    </div>
                    <div id="step2" class="step">
                        <div class="step-number">2</div>
                        <div class="step-text">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</div>
                    </div>
                    <div id="step3" class="step">
                        <div class="step-number">3</div>
                        <div class="step-text">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</div>
                    </div>
                </div>
            </div>

            <!-- Current Balance -->
            <div class="bg-white rounded-lg shadow p-4 mb-6 card-hover">
                <div class="text-center">
                    <p class="text-gray-500 text-sm mb-1">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                    <p id="currentBalance" class="text-2xl font-bold text-blue-600">‡∏ø0.00</p>
                </div>
            </div>

            <!-- Top-up Form -->
            <div class="bg-white rounded-lg shadow p-6 card-hover">
                <h2 class="text-xl font-bold mb-6 text-center">
                    <i class="fas fa-plus-circle mr-2 text-blue-500"></i>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤
                </h2>
                
                <div class="space-y-4">
                    <!-- Amount -->
                    <div>
                        <label class="block text-sm font-medium mb-2">
                            <i class="fas fa-money-bill-wave mr-1"></i>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)
                        </label>
                        <input type="number" id="topupAmount" step="0.01" min="100" placeholder="‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 100 ‡∏ö‡∏≤‡∏ó"
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <p class="text-xs text-gray-500 mt-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 100 ‡∏ö‡∏≤‡∏ó</p>
                    </div>

                    <!-- Bank Selection -->
                    <div>
                        <label class="block text-sm font-medium mb-2">
                            <i class="fas fa-university mr-1"></i>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
                        </label>
                        <select id="topupBank" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="updateAccountNumber()">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ --</option>
                            <option value="‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢</option>
                            <option value="‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û</option>
                            <option value="‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå</option>
                            <option value="‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢</option>
                            <option value="‡∏ó‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏ò‡∏ô‡∏ä‡∏≤‡∏ï">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏ò‡∏ô‡∏ä‡∏≤‡∏ï</option>
                        </select>
                    </div>

                    <!-- Account Number -->
                    <div>
                        <label class="block text-sm font-medium mb-2">
                            <i class="fas fa-credit-card mr-1"></i>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
                        </label>
                        <div class="relative">
                            <input type="text" id="topupAccountNumber" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"
                                   class="w-full p-3 border rounded-lg bg-gray-50" readonly>
                            <button onclick="copyAccountNumber()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</p>
                    </div>

                    <!-- Slip Upload -->
                    <div id="slipUploadSection">
                        <label class="block text-sm font-medium mb-2">
                            <i class="fas fa-upload mr-1"></i>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
                        </label>
                        <label id="topupSlipLabel" for="topupSlip" class="block w-full p-4 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-gray-400 transition text-center">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                            <p class="text-xs text-gray-500 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB</p>
                        </label>
                        <input type="file" id="topupSlip" accept="image/jpeg,image/png" class="hidden">
                        
                        <div id="filePreview" class="mt-3 hidden">
                            <p id="topupFileName" class="text-sm text-gray-600 mb-2"></p>
                            <img id="previewImage" src="" alt="Preview" class="file-preview mt-2 w-full max-h-48 object-cover rounded-lg">
                            <button onclick="removeSlip()" class="mt-2 text-sm text-red-600 hover:text-red-800 btn-animate">
                                <i class="fas fa-trash-alt mr-1"></i>‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå
                            </button>
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <h4 class="font-semibold text-yellow-800 mb-2">
                            <i class="fas fa-info-circle mr-1"></i>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô
                        </h4>
                        <ol class="text-sm text-yellow-700 space-y-1">
                            <li>1. ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
                            <li>2. ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</li>
                            <li>3. ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</li>
                            <li>4. ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 5-10 ‡∏ô‡∏≤‡∏ó‡∏µ</li>
                        </ol>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="flex space-x-3 mt-6">
                    <button id="submitTopupBtn" onclick="submitTopup()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition disabled:opacity-50 disabled:cursor-not-allowed btn-animate">
                        <span id="submitText">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</span>
                        <span id="submitSpinner" class="spinner"></span>
                    </button>
                    <button onclick="goBack()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition btn-animate">
                        <i class="fas fa-times mr-2"></i>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const LIFF_ID = 'your-liff-id-here';
        const API_URL = 'https://script.google.com/macros/s/your-script-id/exec';
        
        // Bank accounts mapping
        const BANK_ACCOUNTS = {
            '‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢': '123-4-56789-0',
            '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û': '987-6-54321-0',
            '‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå': '456-7-89012-3',
            '‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢': '789-0-12345-6',
            '‡∏ó‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏ò‡∏ô‡∏ä‡∏≤‡∏ï': '321-6-54987-0'
        };
        
        const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
        const ALLOWED_FILE_TYPES = ['image/jpeg', 'image/png'];

        // Global Variables
        let userData = {};
        let walletData = { balance: 0 };

        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('th-TH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Go back function
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        // Update account number based on bank selection
        function updateAccountNumber() {
            const bankSelect = document.getElementById('topupBank');
            const accountNumberField = document.getElementById('topupAccountNumber');
            
            if (bankSelect && accountNumberField) {
                const selectedBank = bankSelect.value;
                accountNumberField.value = BANK_ACCOUNTS[selectedBank] || '';
                updateProcessSteps(selectedBank ? 2 : 1);
            }
        }

        // Copy account number to clipboard
        function copyAccountNumber() {
            const accountNumber = document.getElementById('topupAccountNumber').value;
            if (accountNumber) {
                navigator.clipboard.writeText(accountNumber).then(() => {
                    // Show feedback
                    const copyBtn = event.target.closest('button');
                    const originalIcon = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check text-green-600"></i>';
                    setTimeout(() => {
                        copyBtn.innerHTML = originalIcon;
                    }, 2000);
                    
                    // Show toast notification
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                        text: '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß',
                        timer: 1500,
                        showConfirmButton: false,
                        toast: true,
                        position: 'top-end'
                    });
                }).catch(() => {
                    Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ', 'error');
                });
            }
        }

        // Function to update process steps
        function updateProcessSteps(step) {
            // Reset all steps
            document.querySelectorAll('.step').forEach(el => {
                el.classList.remove('active', 'completed');
            });

            // Mark completed steps
            for (let i = 1; i < step; i++) {
                document.getElementById(`step${i}`).classList.add('completed');
            }

            // Mark current step
            if (step <= 3) {
                document.getElementById(`step${step}`).classList.add('active');
            }
        }

        // Function to remove slip
        function removeSlip() {
            document.getElementById('topupSlip').value = '';
            document.getElementById('filePreview').classList.add('hidden');
            document.getElementById('previewImage').src = '';
            document.getElementById('topupFileName').textContent = '';
            updateProcessSteps(2);
        }

        // Submit top-up request - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        async function submitTopup() {
            const amount = parseFloat(document.getElementById('topupAmount').value);
            const bank = document.getElementById('topupBank').value;
            const account = document.getElementById('topupAccountNumber').value;
            const slipFile = document.getElementById('topupSlip').files[0];

            // Validate inputs
            if (!amount || amount < 100) {
                Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏° (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 100 ‡∏ö‡∏≤‡∏ó)', 'error');
                return;
            }
            if (!bank) {
                Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£', 'error');
                return;
            }
            if (!slipFile) {
                Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô', 'error');
                return;
            }

            // Show loading
            const submitBtn = document.getElementById('submitTopupBtn');
            submitBtn.disabled = true;
            document.getElementById('submitSpinner').style.display = 'inline-block';
            document.getElementById('submitText').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...';

            try {
                // Convert file to Base64
                const base64 = await fileToBase64(slipFile);

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á timestamp ‡πÅ‡∏•‡∏∞ transaction ID
                const now = new Date();
                const transactionId = 'TOP' + now.getTime();
                const dateTime = now.toLocaleString('th-TH', {
                    timeZone: 'Asia/Bangkok',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ API_URL ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (API_URL.includes('YOUR_ACTUAL_SCRIPT_ID')) {
                    // ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö - ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    console.log('Demo mode - simulating successful submission');
                    
                    // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏≠ API
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                    const transactionRecord = {
                        id: transactionId,
                        type: 'topup',
                        amount: amount,
                        bank: bank,
                        account: account,
                        dateTime: dateTime,
                        status: 'pending',
                        filename: slipFile.name
                    };
                    
                    saveToLocalHistory(transactionRecord);
                    
                    // ‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö)
                    await Swal.fire({
                        icon: 'success',
                        title: 'üéâ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        html: `
                            <div class="text-center space-y-3">
                                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                    <p class="text-yellow-800 font-semibold">‚ö†Ô∏è ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>
                                    <p class="text-sm text-yellow-700">‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏à‡∏£‡∏¥‡∏á</p>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <p class="text-lg font-semibold text-green-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</p>
                                    <hr class="my-2">
                                    <div class="text-left space-y-1">
                                        <p><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</strong> ${transactionId}</p>
                                        <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong> ‡∏ø${formatCurrency(amount)}</p>
                                        <p><strong>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</strong> ${bank}</p>
                                        <p><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</strong> ${account}</p>
                                        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${dateTime}</p>
                                    </div>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <p class="text-sm text-blue-800">üìù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script</p>
                                    <p class="text-sm text-blue-800">üîó ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏™‡πà URL ‡πÉ‡∏ô API_URL</p>
                                </div>
                            </div>
                        `,
                        confirmButtonText: '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å',
                        confirmButtonColor: '#10b981',
                        allowOutsideClick: false
                    });
                    
                    // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);
                    
                    return; // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                }

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á FormData ‡πÅ‡∏ó‡∏ô JSON ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS
                const formData = new FormData();
                formData.append('action', 'deposit'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô action ‡∏ó‡∏µ‡πà GS ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
                formData.append('userId', userData.userId);
                formData.append('amount', amount.toString());
                formData.append('bank', bank);
                formData.append('account', account);
                formData.append('slip', base64);
                formData.append('filename', slipFile.name);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡∏¥‡∏°
                formData.append('transactionId', transactionId);
                formData.append('dateTime', dateTime);

                console.log('Sending FormData with transaction ID:', transactionId);

                // Send data to Google Apps Script ‡πÅ‡∏ö‡∏ö FormData (‡πÑ‡∏°‡πà‡∏°‡∏µ CORS issue)
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà Content-Type header ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ FormData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô text ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON
                const resultText = await response.text();
                console.log('Raw server response:', resultText);
                
                let result;
                try {
                    result = JSON.parse(resultText);
                } catch (parseError) {
                    console.log('Response is not JSON, treating as text response');
                    result = { success: true, message: resultText };
                }
                
                console.log('Parsed server response:', result);

                if (result.success || resultText.includes('success') || resultText.includes('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à') || resultText.includes('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢')) {
                    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å response ‡∏Ç‡∏≠‡∏á GS
                    const finalTransactionId = result.transactionId || transactionId;
                    const finalSlipUrl = result.slipUrl || '';
                    const finalStatus = result.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                    const transactionRecord = {
                        id: finalTransactionId,
                        type: 'deposit', 
                        amount: amount,
                        bank: bank,
                        account: account,
                        dateTime: dateTime,
                        status: finalStatus,
                        filename: slipFile.name,
                        slipUrl: finalSlipUrl
                    };
                    
                    saveToLocalHistory(transactionRecord);
                    
                    // ‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    await Swal.fire({
                        icon: 'success',
                        title: 'üéâ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        html: `
                            <div class="text-center space-y-3">
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <p class="text-lg font-semibold text-green-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</p>
                                    <hr class="my-2">
                                    <div class="text-left space-y-1">
                                        <p><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</strong> ${finalTransactionId}</p>
                                        <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong> ‡∏ø${formatCurrency(amount)}</p>
                                        <p><strong>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</strong> ${bank}</p>
                                        <p><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</strong> ${account}</p>
                                        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${dateTime}</p>
                                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span class="text-orange-600">${finalStatus}</span></p>
                                        ${finalSlipUrl ? `<p><strong>‡∏™‡∏•‡∏¥‡∏õ:</strong> <a href="${finalSlipUrl}" target="_blank" class="text-blue-600 underline">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a></p>` : ''}
                                    </div>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <p class="text-sm text-blue-800">üí∞ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</p>
                                    <p class="text-sm text-blue-800">üì± ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</p>
                                    <p class="text-sm text-blue-800">üìÑ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                    ${result.message ? `<p class="text-sm text-blue-800 mt-2 font-semibold">üìù ${result.message}</p>` : ''}
                                </div>
                            </div>
                        `,
                        confirmButtonText: '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å',
                        confirmButtonColor: '#10b981',
                        allowOutsideClick: false
                    });
                    
                    // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                    try {
                        if (typeof liff !== 'undefined' && liff.isApiAvailable && liff.isApiAvailable('shareTargetPicker')) {
                            const message = {
                                type: 'text',
                                text: `‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\nüí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ‡∏ø${formatCurrency(amount)}\nüè¶ ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ${bank}\nüìÑ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${transactionId}\n‚è∞ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 1-2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£\nüìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£`
                            };
                            
                            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
                            await liff.sendMessages([message]);
                        }
                    } catch (lineError) {
                        console.log('LINE notification error (non-critical):', lineError);
                    }
                    
                    // ‡πÅ‡∏™‡∏î‡∏á success notification
                    await showSuccessNotification(transactionRecord);
                    
                    // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);
                    
                } else {
                    throw new Error(result.message || resultText || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ');
                }
            } catch (error) {
                console.error('Topup error:', error);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞
                if (error.message.includes('404') || API_URL.includes('YOUR_ACTUAL_SCRIPT_ID')) {
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script
                    Swal.fire({
                        icon: 'info',
                        title: 'üîß ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script',
                        html: `
                            <div class="text-left space-y-3">
                                <p class="text-gray-700">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ:</p>
                                
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-800 mb-2">üìù ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:</h4>
                                    <ol class="text-sm text-blue-700 space-y-1">
                                        <li>1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://script.google.com" target="_blank" class="underline">script.google.com</a></li>
                                        <li>2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Project ‡πÉ‡∏´‡∏°‡πà</li>
                                        <li>3. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î Google Apps Script</li>
                                        <li>4. Deploy ‡πÄ‡∏õ‡πá‡∏ô Web App</li>
                                        <li>5. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô API_URL</li>
                                    </ol>
                                </div>
                                
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <p class="text-sm text-yellow-700">
                                        <strong>‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö<br>
                                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                                    </p>
                                </div>
                                
                                <div class="bg-gray-50 p-3 rounded text-sm">
                                    <p class="font-semibold mb-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å:</p>
                                    <p>‚Ä¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ‡∏ø${formatCurrency(amount)}</p>
                                    <p>‚Ä¢ ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ${bank}</p>
                                    <p>‚Ä¢ ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ: ${slipFile.name}</p>
                                </div>
                            </div>
                        `,
                        confirmButtonColor: '#3b82f6',
                        confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                        footer: '<a href="https://script.google.com" target="_blank" class="text-blue-600 underline">‡πÄ‡∏õ‡∏¥‡∏î Google Apps Script</a>'
                    });
                } else {
                    // ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                    let errorMessage = handleNetworkError(error);
                    
                    if (error.message.includes('CORS')) {
                        errorMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                    } else if (error.message.includes('NetworkError')) {
                        errorMessage = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
                    }
                    
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        html: `
                            <div class="text-left">
                                <p class="mb-3">${errorMessage}</p>
                                <div class="bg-gray-50 p-3 rounded text-sm">
                                    <p class="font-semibold mb-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å:</p>
                                    <p>‚Ä¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ‡∏ø${formatCurrency(amount)}</p>
                                    <p>‚Ä¢ ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ${bank}</p>
                                    <p>‚Ä¢ ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ: ${slipFile.name}</p>
                                </div>
                                <p class="mt-3 text-sm text-gray-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏≠‡∏á‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ</p>
                            </div>
                        `,
                        confirmButtonColor: '#ef4444',
                        confirmButtonText: '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'
                    });
                }
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                document.getElementById('submitSpinner').style.display = 'none';
                document.getElementById('submitText').textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô';
            }
        }

        // Load Wallet Data - ‡πÉ‡∏ä‡πâ API ‡∏Ç‡∏≠‡∏á GS ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        async function loadWalletData() {
            try {
                const response = await fetch(`${API_URL}?action=getWallet&userId=${userData.userId}`, {
                    method: 'GET'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Wallet data response:', data);
                    
                    if (data.success) {
                        walletData.balance = data.balance || 0;
                        document.getElementById('currentBalance').textContent = '‡∏ø' + formatCurrency(walletData.balance);
                    } else {
                        console.error('Failed to load wallet data:', data.message);
                        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ
                        walletData.balance = 0;
                        document.getElementById('currentBalance').textContent = '‡∏ø0.00';
                    }
                } else {
                    console.error('HTTP error getting wallet:', response.status);
                    walletData.balance = 0;
                    document.getElementById('currentBalance').textContent = '‡∏ø0.00';
                }
            } catch (error) {
                console.error('Error loading wallet data:', error);
                // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                walletData.balance = 0;
                document.getElementById('currentBalance').textContent = '‡∏ø0.00';
            }
        }

        // Initialize LIFF (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
        window.onload = async function() {
            try {
                // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£ init LIFF (‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ LIFF ID ‡∏à‡∏£‡∏¥‡∏á)
                // await liff.init({ liffId: LIFF_ID });
                
                // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
                initApp();
            } catch (err) {
                console.error('LIFF init failed:', err);
                // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                initApp();
            }
        };

        // Initialize App
        async function initApp() {
            try {
                // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å liff.getProfile())
                userData = {
                    userId: 'demo-user-12345',
                    name: '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                    picture: 'https://via.placeholder.com/150'
                };

                await loadWalletData();
                updateProcessSteps(1);

                // Set up file input handlers
                setupFileHandlers();
                
                // Set up amount validation
                setupAmountValidation();

                // Show app
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error initializing app:', error);
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ', 'error');
            }
        }

        // Setup file input handlers
        function setupFileHandlers() {
            const fileInput = document.getElementById('topupSlip');
            const fileLabel = document.getElementById('topupSlipLabel');
            const filePreview = document.getElementById('filePreview');
            const fileName = document.getElementById('topupFileName');
            const previewImage = document.getElementById('previewImage');

            // File input change handler
            fileInput.addEventListener('change', function(e) {
                handleFileSelect(e.target.files[0]);
            });

            // Drag and drop functionality
            fileLabel.addEventListener('dragover', function(e) {
                e.preventDefault();
                fileLabel.classList.add('border-blue-500', 'bg-blue-50');
                fileLabel.querySelector('p').textContent = '‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î';
            });

            fileLabel.addEventListener('dragleave', function() {
                fileLabel.classList.remove('border-blue-500', 'bg-blue-50');
                fileLabel.querySelector('p').textContent = '‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';
            });

            fileLabel.addEventListener('drop', function(e) {
                e.preventDefault();
                fileLabel.classList.remove('border-blue-500', 'bg-blue-50');
                fileLabel.querySelector('p').textContent = '‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';

                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });
        }

        // Handle file selection
        function handleFileSelect(file) {
            if (!file) return;

            // Validate file type
            if (!ALLOWED_FILE_TYPES.includes(file.type)) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    text: '‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û JPG ‡∏´‡∏£‡∏∑‡∏≠ PNG ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
                    confirmButtonColor: '#3b82f6'
                });
                document.getElementById('topupSlip').value = '';
                return;
            }

            // Validate file size
            if (file.size > MAX_FILE_SIZE) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ',
                    text: '‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB',
                    confirmButtonColor: '#3b82f6'
                });
                document.getElementById('topupSlip').value = '';
                return;
            }

            // Show file preview
            const fileName = document.getElementById('topupFileName');
            const filePreview = document.getElementById('filePreview');
            const previewImage = document.getElementById('previewImage');

            fileName.textContent = `üìé ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
            filePreview.classList.remove('hidden');
            updateProcessSteps(3);

            // Show preview image
            const reader = new FileReader();
            reader.onload = function(event) {
                previewImage.src = event.target.result;
            };
            reader.readAsDataURL(file);

            // Set file to input if it was dropped
            if (!document.getElementById('topupSlip').files.length) {
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                document.getElementById('topupSlip').files = dataTransfer.files;
            }
        }

        // Setup amount validation
        function setupAmountValidation() {
            const amountInput = document.getElementById('topupAmount');
            const submitBtn = document.getElementById('submitTopupBtn');

            amountInput.addEventListener('input', function() {
                const amount = parseFloat(this.value) || 0;
                const bank = document.getElementById('topupBank').value;
                const hasSlip = document.getElementById('topupSlip').files.length > 0;

                // Validate amount
                if (amount < 100) {
                    this.style.borderColor = '#ef4444';
                    this.style.backgroundColor = '#fef2f2';
                } else {
                    this.style.borderColor = '#10b981';
                    this.style.backgroundColor = '#f0fdf4';
                }

                // Enable/disable submit button
                submitBtn.disabled = !(amount >= 100 && bank && hasSlip);
            });

            // Also check when bank changes
            document.getElementById('topupBank').addEventListener('change', function() {
                const amount = parseFloat(amountInput.value) || 0;
                const bank = this.value;
                const hasSlip = document.getElementById('topupSlip').files.length > 0;
                
                submitBtn.disabled = !(amount >= 100 && bank && hasSlip);
            });
        }

        // Google Apps Script Integration Functions
        async function sendToGoogleSheets(data) {
            try {
                // ‡πÉ‡∏ä‡πâ FormData ‡πÅ‡∏ó‡∏ô JSON ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á CORS issues
                const formData = new FormData();
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏á‡πÉ‡∏ô FormData
                Object.keys(data).forEach(key => {
                    formData.append(key, data[key]);
                });

                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà headers ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ FormData
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                // ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô text ‡∏Å‡πà‡∏≠‡∏ô
                const resultText = await response.text();
                
                // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON
                try {
                    return JSON.parse(resultText);
                } catch (parseError) {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ success ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    return {
                        success: resultText.includes('success') || resultText.includes('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'),
                        message: resultText
                    };
                }
            } catch (error) {
                console.error('Google Sheets API Error:', error);
                throw error;
            }
        }

        // Alternative fetch method ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Google Apps Script
        async function sendDataToGAS(data) {
            // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ FormData (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
            const formData = new FormData();
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô FormData
            for (const [key, value] of Object.entries(data)) {
                formData.append(key, value);
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.text();
                console.log('GAS Response:', result);
                
                return {
                    success: true,
                    data: result
                };
            } catch (error) {
                console.error('Error sending to GAS:', error);
                throw error;
            }
        }

        // Transaction History Functions
        function saveToLocalHistory(transaction) {
            try {
                let history = JSON.parse(localStorage.getItem('topupHistory') || '[]');
                history.unshift(transaction);
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                if (history.length > 50) {
                    history = history.slice(0, 50);
                }
                
                localStorage.setItem('topupHistory', JSON.stringify(history));
            } catch (error) {
                console.error('Error saving to local history:', error);
            }
        }

        // Format functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function generateTransactionId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `TOP${timestamp}${random}`;
        }

        // Error handling functions
        function handleNetworkError(error) {
            console.error('Network error:', error);
            
            if (error.name === 'TypeError' && error.message.includes('fetch')) {
                return '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
            }
            
            if (error.message.includes('timeout')) {
                return '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
            }
            
            return '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
        }

        // Validation functions
        function validateTopupData(amount, bank, slip) {
            const errors = [];
            
            if (!amount || amount < 100) {
                errors.push('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 100 ‡∏ö‡∏≤‡∏ó');
            }
            
            if (amount > 1000000) {
                errors.push('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1,000,000 ‡∏ö‡∏≤‡∏ó');
            }
            
            if (!bank) {
                errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£');
            }
            
            if (!slip) {
                errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');
            }
            
            return errors;
        }

        // Success notification
        async function showSuccessNotification(transactionData) {
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Toast
            const toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });

            await toast.fire({
                icon: 'success',
                title: '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏ø${formatCurrency(transactionData.amount)}`
            });
        }

        // Debug functions (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤)
        function debugLog(message, data = null) {
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                console.log(`[TOPUP DEBUG] ${message}`, data);
            }
        }

        // Performance monitoring
        function trackPerformance(actionName, startTime) {
            const endTime = performance.now();
            const duration = endTime - startTime;
            debugLog(`Performance: ${actionName} took ${duration.toFixed(2)}ms`);
        }

        // Initialize performance tracking
        const initStartTime = performance.now();
        
        // Track when page is fully loaded
        window.addEventListener('load', () => {
            trackPerformance('Page Load', initStartTime);
        });

        // Service Worker registration (for offline support - optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        debugLog('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        debugLog('SW registration failed: ', registrationError);
                    });
            });
        }

        // Cleanup function
        window.addEventListener('beforeunload', () => {
            // Cleanup any ongoing operations
            if (window.uploadController) {
                window.uploadController.abort();
            }
        });
    </script>
</body>
</html>
